#!/usr/bin/env sh

# Run translation validation (Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹)
echo "ğŸŒ Validating translations..."
npm run validate:translations

# Check if validation failed
if [ $? -ne 0 ]; then
  echo "âŒ Translation validation failed. Please fix missing translations before committing."
  echo "ğŸ’¡ Tip: Run 'npm run validate:translations' to see all missing translations"
  exit 1
fi

echo "âœ… Translation validation passed!"

# TypeScript type checking (Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ²)
echo "ğŸ”§ Running TypeScript type check..."
npx tsc --noEmit

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Please fix type errors before committing."
  exit 1
fi

echo "âœ… TypeScript type check passed!"

# Run linting (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ, Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµĞ¼)
echo "ğŸ” Running ESLint (showing warnings only)..."
npm run lint || echo "âš ï¸  Found ESLint warnings, but allowing commit to proceed"

# Check build (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ)
echo "ğŸ—ï¸  Testing build process..."
npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix build errors before committing."
  exit 1
fi

echo "âœ… Build check passed!"

# Prettier formatting check (Ğ½Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼)
if command -v npx >/dev/null 2>&1; then
  echo "ğŸ’… Checking code formatting..."
  npx prettier --check "**/*.{ts,tsx,js,jsx,json,css,md}" 2>/dev/null || {
    echo "âš ï¸  Code formatting issues found. Consider running 'npx prettier --write .' to fix them."
    echo "ğŸ’¡ Tip: This is just a warning, commit will proceed"
  }
fi

echo "ğŸ‰ All critical checks passed! Ready to commit."
