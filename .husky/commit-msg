#!/usr/bin/env sh

echo "ğŸ“ Validating commit message format..."

commit_message=$(cat "$1")

# Check if commit message is too short
if [ ${#commit_message} -lt 10 ]; then
  echo "âŒ Commit message too short (minimum 10 characters)"
  echo "ğŸ’¡ Example: 'feat: add password strength indicator widget'"
  exit 1
fi

# Check if commit message is too long - DISABLED

# Conventional commits validation
if echo "$commit_message" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|ci|perf|build|revert)(\(.+\))?: .{3,}"; then
  echo "âœ… Conventional commit format detected"
  
  # Check for widget-related commits
  if echo "$commit_message" | grep -qi "widget"; then
    echo "ğŸ¯ Widget-related commit detected"
    echo "ğŸ“‹ Ensure you've completed widget checklist:"
    echo "   - Bilingual translations (EN/RU)"
    echo "   - Keyboard shortcuts"
    echo "   - Mobile responsiveness"
    echo "   - SEO metadata"
    echo "   - Analytics tracking"
  fi
  
  echo "âœ… Commit message validation passed!"
  exit 0
fi

# Check for Russian commit messages (allow them)
if echo "$commit_message" | grep -q '[Ğ°-ÑÑ‘]'; then
  echo "ğŸ‡·ğŸ‡º Russian commit message detected - allowed"
  exit 0
fi

# Check for common patterns
if echo "$commit_message" | grep -qiE "^(add|update|fix|remove|improve|implement|create): "; then
  echo "âœ… Standard commit format detected"
  exit 0
fi

# If none of the patterns match, show error
echo "âŒ Invalid commit message format"
echo ""
echo "ğŸ“‹ Accepted formats:"
echo "   1. Conventional commits: feat: add new widget"
echo "   2. Standard format: add: new password generator"
echo "   3. Russian messages: Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ: Ğ±Ğ°Ğ³ Ğ² Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ğµ"
echo ""
echo "ğŸ”¤ Types for conventional commits:"
echo "   feat:     New feature"
echo "   fix:      Bug fix"
echo "   docs:     Documentation"
echo "   style:    Code style (formatting)"
echo "   refactor: Code refactoring"
echo "   test:     Adding tests"
echo "   chore:    Maintenance tasks"
echo "   perf:     Performance improvements"
echo ""
echo "ğŸ’¡ Your message: '$commit_message'"
echo ""

exit 1